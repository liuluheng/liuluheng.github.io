<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Kernel Total</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="Kernel Total"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2013-05-05T10:13+0800"/>
<meta name="author" content="Shi Shougang"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style><link rel="stylesheet" href="./assets/stylesheet.css" type="text/css"/>
<link rel="stylesheet" type="text/css" href="../../assets/stylesheet.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>
<div id="org-div-home-and-up" style="text-align:right;font-size:70%;white-space:nowrap;">
 <a accesskey="h" href="../../index.html"> UP </a>
 |
 <a accesskey="H" href="../../index.html"> HOME </a>
</div>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">Kernel Total</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">General</a></li>
<li><a href="#sec-2">kernel download</a></li>
<li><a href="#sec-3">docs</a>
<ul>
<li><a href="#sec-3-1">docs</a></li>
<li><a href="#sec-3-2">wiki</a></li>
<li><a href="#sec-3-3">articles</a></li>
</ul>
</li>
<li><a href="#sec-4">ChinaUnix 内核源码版精华帖分类汇总</a></li>
<li><a href="#sec-5">水木社区  KernelTech版FAQ1.1</a></li>
<li><a href="#sec-6">Blogs</a></li>
<li><a href="#sec-7">Linux Cross Reference</a></li>
<li><a href="#sec-8">kernel blog</a></li>
<li><a href="#sec-9">The Linux Kernel API</a></li>
<li><a href="#sec-10">Embedded Linux Wiki</a></li>
<li><a href="#sec-11">Openembedded</a></li>
<li><a href="#sec-12">Overo</a></li>
<li><a href="#sec-13">free-electrons</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1">General</h2>
<div class="outline-text-2" id="text-1">

<p><a href="http://kernelnewbies.org/">http://kernelnewbies.org/</a>
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2">kernel download</h2>
<div class="outline-text-2" id="text-2">

<ul>
<li>x86           <a href="http://www.kernel.org/">http://www.kernel.org/</a>
</li>
<li>ARM       <a href="http://www.arm.linux.org.uk/developer/">http://www.arm.linux.org.uk/developer/</a>
</li>
<li>PowerPC   <a href="http://penguinppc.org/">http://penguinppc.org/</a>
</li>
<li>MIPS          <a href="http://www.linux-mips.org/">http://www.linux-mips.org/</a>
</li>
<li>SuperH         <a href="http://linuxsh.sourceforge.net/">http://linuxsh.sourceforge.net/</a>
</li>
<li>M68K          <a href="http://www.linux-m68k.org/">http://www.linux-m68k.org/</a>
</li>
<li>non-MMU CPUs  <a href="http://www.uclinux.org/">http://www.uclinux.org/</a>
</li>
</ul>


</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3">docs</h2>
<div class="outline-text-2" id="text-3">


</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1">docs</h3>
<div class="outline-text-3" id="text-3-1">

<ul>
<li>The Linux documentation project
</li>
</ul>

<p><a href="http://tldp.org/">http://tldp.org/</a>
</p>
<ul>
<li>
</li>
</ul>


</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2">wiki</h3>
<div class="outline-text-3" id="text-3-2">

<ul>
<li><a href="http://www.linux-mips.org/wiki/Main_Page">http://www.linux-mips.org/wiki/Main_Page</a>
</li>
<li>
</li>
</ul>


</div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3">articles</h3>
<div class="outline-text-3" id="text-3-3">

<ul>
<li><a href="http://www.linux.it/~rubini/docs/">http://www.linux.it/~rubini/docs/</a>
</li>
</ul>

</div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4">ChinaUnix 内核源码版精华帖分类汇总</h2>
<div class="outline-text-2" id="text-4">

<p><a href="http://bbs.chinaunix.net/thread-1930079-1-1.html">http://bbs.chinaunix.net/thread-1930079-1-1.html</a>
</p>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5">水木社区  KernelTech版FAQ1.1</h2>
<div class="outline-text-2" id="text-5">

<p>1.资源问题 
1.1 请推荐一些好的Linux内核参考书？ 
1.2 请推荐一些好的学习网站 
1.3 本版ftp 
</p>
<ol>
<li>源代码问题 
</li>
</ol>

<p>2.1 如何得到某一版本的Linux内核源代码? 
2.2 请问xx命令、xx库的源码是哪个文件？ 
2.3 linux-2.x.x.tar.gz.sign 文件有什么用途？ 
2.4 请推荐一些源代码查看工具？ 
2.5 内核patch如patch-2.6.3怎么用？ 
2.6 如何统计linux内核有多少行代码? 
2.7 xx结构的定义在哪个内核源文件中？ 
2.8 volatile和_<sub>volatile</sub>_<sub>是什么意思？</sub> 
2.9 do{ &hellip; } while(0)是什么意思？ 
2.10 list<sub>entry的定义是怎么回事？</sub> 
2.11 为什么有些内核变量找不到定义？ 
</p>
<ol>
<li>模块编程问题 
</li>
</ol>

<p>3.1 模块编程需要注意什么？ 
3.2 为什么insmod一个模块时显示版本不匹配？ 
3.3 为什么出现Unresolved Symbol错误？ 
3.4 为什么出现no license错误？ 
3.5 为什么看不到用printk打印的信息？ 
</p>
<ol>
<li>内核开发问题 
</li>
</ol>

<p>4.1 怎么制作、使用patch文件？ 
4.2 在内核中可以使用系统调用吗？ 
4.3 在内核中怎么打开并操作一个文件？ 
4.4 在内核中读写文件时为什么会出现EFAULT(-14)错误？ 
4.5 怎么在系统中增加一个自己的系统调用？ 
4.6 怎么在内核中加入我自己的驱动程序？ 
4.7 怎么通过程序得到cpu和mem使用率？ 
4.8 如何获得高精度的系统时间？ 
4.9 怎么进行系统性能调谐？ 
4.10 内核中怎么进行互斥？ 
</p>
<ol>
<li>其它问题 
</li>
</ol>

<p>5.1 如何学习Linux内核？ 
5.2 如何下载精华区？ 
5.3 init进程是核心进程吗？init与初始进程是不是一回事？ 
5.4 initrd(.img)有什么用？ 
</p>
<ol>
<li>关于本FAQ 
</li>
<li>Changelog 
</li>
</ol>



<p>  
1.资源问题 
1.1 请推荐一些好的Linux内核参考书？ 
   a.《Linux Device Drivers, 2nd Edition》，有中文译本 
   b.《Understanding the Linux Kernel, 3nd Edition》 
   c.《Linux内核源代码情景分析》，分上下两册 
   d.《边干边学－Linux内核指导》 
   e.《Linux内核2.4版源代码分析大全》 
   f.《Linux Kernel Development》 
   g.《IA-64 Linux Kernel: Design and Implementation》 
   注：a电子版可在<a href="http://www.oreilly.com/catalog/linuxdrive2/下载">http://www.oreilly.com/catalog/linuxdrive2/下载</a>； 
       f和g比较新，在国内比较难买到。 
   h./Documentation/DocBook &amp; /Documentation/kernel-docs.txt 
</p>
<p>  
1.2请推荐一些好的学习网站 
</p><ol>
<li>开源/文档/社区/信息资源 
</li>
</ol>

<p>         1.01 <a href="http://www.kernel.org">http://www.kernel.org</a> 
                 Linux内核主页 
</p>
<p>  
         1.02 <a href="http://www.gnu.org">http://www.gnu.org</a> or <a href="http://www.fsf.org">http://www.fsf.org</a> 
                 GNU/FSF主页 
</p>
<p>  
         1.03 <a href="http://www.opensource.org">http://www.opensource.org</a> 
                 Open Source权威网站 
</p>
<p>  
         1.04 <a href="http://www.osdl.org">http://www.osdl.org</a> 
                 OSDL(Open Source Development Labs, Linus Torvalds的家)主页 
</p>
<p>  
         1.05 <a href="http://www.sourceforge.net">http://www.sourceforge.net</a> 
                 大型开放源码软件网站 
</p>
<p>  
         1.06 <a href="http://freshmeat.net/">http://freshmeat.net/</a> 
                 大型开放源码软件网站 
</p>
<p>  
         1.07 <a href="http://osdir.com">http://osdir.com</a> 
              开放源码目录，提供许多开放源码软件的索引和链接 
</p>
<p>          
         1.08 <a href="http://www.rpmfind.net">http://www.rpmfind.net</a> 
              提供RPM包的搜索和链接 
</p>
<p>          
         1.09 <a href="http://oss.sgi.com/projects/">http://oss.sgi.com/projects/</a> 
              SGI的开放源码Linux项目 
</p>
<p>          
         1.10 <a href="http://oss.software.ibm.com/linux/">http://oss.software.ibm.com/linux/</a> 
              IBM的开放源码Linux项目 
</p>
<p>          
         1.11 <a href="http://www-124.ibm.com/developerworks/oss/">http://www-124.ibm.com/developerworks/oss/</a> 
              IBM developerWorks的开放源码Linux项目 
</p>
<p>          
         1.12 <a href="http://www.kerneltrap.org">http://www.kerneltrap.org</a> 
              内核开发相关信息和论坛 
</p>
<p>          
         1.13 <a href="http://kernelnewbies.org">http://kernelnewbies.org</a> 
              很好的内核学习网站 
</p>
<p>          
         1.14 <a href="http://www.kernelhacking.org/">http://www.kernelhacking.org/</a> 
              kernelhacking-HOWTO文档 
</p>
<p>          
         1.15 <a href="http://www.tldp.org">http://www.tldp.org</a> 
              Linux文档 
</p>
<p>          
         1.16 <a href="http://www.nongnu.org/lkdp/">http://www.nongnu.org/lkdp/</a> 
              Linux内核文档 
</p>
<p>          
         1.17 <a href="http://linux-mm.org/">http://linux-mm.org/</a> 
              Linux内核mm文档 
</p>
<p>          
         1.18 <a href="http://www.linuxforum.net">http://www.linuxforum.net</a> 
              中国Linux论坛 
</p>
<p>          
         1.19 <a href="http://www.aka.org.cn">http://www.aka.org.cn</a> 
              中国信息技术论坛－阿卡（AKA） 
</p>
<p>          
         1.20 <a href="http://www.lisoleg.net">http://www.lisoleg.net</a> 
              利索脚(Linux Source Learning Group) 
</p>
<p>          
         1.21 <a href="http://www.linuxfans.org/">http://www.linuxfans.org/</a> 
              中国Linux公社 
</p>
<p>          
         1.22 <a href="http://www-900.ibm.com/developerWorks/cn/linux">http://www-900.ibm.com/developerWorks/cn/linux</a> 
              IBM developerWorks Linux专区 
</p>
<p>          
         1.23 <a href="http://www.linuxaid.com.cn">http://www.linuxaid.com.cn</a> 
              LinuxAid技术支持中心 
</p>
<p>          
         1.24 <a href="http://lxr.linux.no/source/">http://lxr.linux.no/source/</a> 
              Cross-Referencing Linux，可在线查看Linux内核源代码 
</p>
<p>          
         1.25 <a href="http://www.linux.org">http://www.linux.org</a> 
              Linux信息资源 
</p>
<p>          
         1.26 <a href="http://www.linuxdevices.com">http://www.linuxdevices.com</a> 
              嵌入式Linux信息资源 
</p>
<p>          
         1.27 <a href="http://www.linuxjournal.com/webindex.php">http://www.linuxjournal.com/webindex.php</a> 
              Linux Journal杂志在线文章 
</p>
<p>          
         1.28 <a href="http://www.joyfire.net/">http://www.joyfire.net/</a> 
              本站joyfire大侠维护的站点 
</p>
<p>          
         1.29 <a href="http://lwn.net">http://lwn.net</a> 
              Linux Weekly News 
</p>
<p>          
         1.30 <a href="http://www.ctyme.com/intr/int.htm">http://www.ctyme.com/intr/int.htm</a> 
              关于BIOS系统调用，很全 
</p><ol>
<li>项目资源 
</li>
</ol>

<p>         2.01 <a href="http://perso.wanadoo.es/xose/linux/linux_ports.html">http://perso.wanadoo.es/xose/linux/linux_ports.html</a> 
              Linux移植项目链接资源 
</p>
<p>          
         2.02 <a href="http://www.uclinux.org">http://www.uclinux.org</a> 
              uClinux主页 
</p>
<p>          
         2.03 <a href="http://www.fsmlabs.com/">http://www.fsmlabs.com/</a> or <a href="http://www.rtlinux.org">http://www.rtlinux.org</a> 
              RTLinux(Real-Time Linux)主页 
</p>
<p>          
         2.04 <a href="http://mail.aero.polimi.it/~rtai/">http://mail.aero.polimi.it/~rtai/</a> 
              RTAI(Real Time Application Interface for Linux)主页 
</p>
<p>          
         2.05 <a href="http://www.ittc.ku.edu/kurt/">http://www.ittc.ku.edu/kurt/</a> 
              KURT-Linux(Kansas University Real-Time Linux)主页 
</p>
<p>          
         2.06 <a href="http://www.arm.linux.org.uk/">http://www.arm.linux.org.uk/</a> 
              ARM Linux主页 
</p>
<p>          
         2.07 <a href="http://www.linux-mips.org/">http://www.linux-mips.org/</a> 
              Linux/MIPS主页 
</p>
<p>          
         2.08 <a href="http://penguinppc.org/">http://penguinppc.org/</a> 
              Linux/PowerPC主页 
</p>
<p>          
         2.09 <a href="http://www.denx.de">http://www.denx.de</a> 
              Denx Software Engineering, PowerPC系列嵌入式Linux资源 
</p>
<p>          
         2.10 <a href="http://www.netfilter.org/">http://www.netfilter.org/</a> or <a href="http://www.iptables.org/">http://www.iptables.org/</a> 
              netfilter/iptables项目 
</p>
<p>          
         2.11 <a href="http://www.linuxfromscratch.org">http://www.linuxfromscratch.org</a> 
              LFS(Linux From Scratch)项目 
</p>
<p>          
         2.12 <a href="http://www.uclibc.org">http://www.uclibc.org</a> 
              uClibc(C library for developing embedded Linux systems)主页 
</p>
<p>          
         2.13 <a href="http://www.LinuxVirtualServer.org">http://www.LinuxVirtualServer.org</a> 
              章文嵩主持的Linux Virtual Server项目 
</p>
<p>          
         2.14 <a href="http://linux-ha.org">http://linux-ha.org</a> 
              High-Availability Linux项目 
</p>
<p>          
         2.15 <a href="http://www.lids.org">http://www.lids.org</a> 
              本站vertex大侠主持的LIDS(Linux Intrusion Detection System)项目 
</p>
<p>          
         2.16 <a href="http://www.minigui.org/">http://www.minigui.org/</a> 
              本站Kongming大侠主持的MiniGUI项目 
</p>
<p>          
         2.17 <a href="http://user-mode-linux.sourceforge.net/">http://user-mode-linux.sourceforge.net/</a> 
              User-Mode Linux项目 
</p>
<p>          
         2.18 <a href="http://lse.sourceforge.net/">http://lse.sourceforge.net/</a> 
              Linux Scalability Effort项目 
</p>
<p>          
         2.19 <a href="http://linuxperf.nl.linux.org/">http://linuxperf.nl.linux.org/</a> 
              Linux Performance Tuning项目 
</p>
<p>          
         2.20 <a href="http://euclid.nmu.edu/~benchmark/">http://euclid.nmu.edu/~benchmark/</a> 
              Linux Benchmark项目 
1.3本版ftp 
         <a href="ftp://kernel:kernel@kernel.trueice.net:8021/">ftp://kernel:kernel@kernel.trueice.net:8021/</a> 
                 /incoming/kerneltech.newsmth 
</p>
<p>                  
         目前我所能找到的内核方面的经典书籍电子版都有 
         特别感谢trueice网友提供本版ftp^_^ 
</p>

<ol>
<li>源代码问题 
</li>
</ol>

<p>2.1 如何得到某一版本的Linux内核源代码? 
    a. <a href="http://www.kernel.org或ftp://ftp.kernel.org，这是Linux内核版本的发布">http://www.kernel.org或ftp://ftp.kernel.org，这是Linux内核版本的发布</a> 
       网站。 
    b. 很多镜像或本地网站也提供部分Linux内核版本的下载，多用ftp搜索引擎。 
    c. 一般的Linux发行版如Redhat之类会随盘提供相应的内核源代码，不过这个源代 
       码往往是改动过的，与标准Linux内核有差异。 
</p>
<p>  
2.2 请问xx命令、xx库的源码是哪个文件？ 
    a. 一个系统除了内核以外，还需要有shell、gcc等一系列工具和命令以及C库等一 
       系列库，这些作为应用程序其源代码都不在内核中，需要另外下载相应的源代码。 
    b. 对于Redhat系统，可以用rpm -qf命令来查找某一命令所在的软件包，然后再找 
       相应的源代码包安装。 
    c. gnu.org有很多软件源代码如bash/glibc/binutils/make/gcc的源代码。 
    d. 可在<a href="http://www.rpmfind.net或http://www.google.com去搜一搜">http://www.rpmfind.net或http://www.google.com去搜一搜</a>。 
</p>
<p>  
2.3 linux-2.x.x.tar.gz.sign 文件有什么用途？ 
     这是一个数字签名文件，用来校验linux-2.x.x.tar.gz这个文件在签名后是没有 
     被第三方修改过,更详细的信息参考<a href="http://www.kernel.org/signature.html">http://www.kernel.org/signature.html</a>。 
</p>
<p>  
2.4 请推荐一些源代码查看工具？ 
    a. Windows系统可以用Source Insight，Linux系统可以用Source Navigator。 
    b. vim或emacs编辑器，配合cscope、ctags、etags等交叉索引工具。 
    c. vim或emacs编辑器，配合grep、egrep等文本搜索工具，不过最好要对源代码目 
       录结构有所熟悉 
    d. LXR，以网页的形式通过浏览器浏览，安装复杂，可从<a href="http://lxr.linux.no/下">http://lxr.linux.no/下</a> 
       载该工具也可以直接访问<a href="http://lxr.linux.no/source/在线阅读Linux内核源">http://lxr.linux.no/source/在线阅读Linux内核源</a> 
       代码。 
    e. GNU global,可以在命令行用，也可以生成hypertext，类似lxr，但更省事。 
</p>
<p>  
2.5 内核patch如patch-2.6.3怎么用？ 
    a. 内核patch一般是针对前一个版本，如patch-2.6.3是针对2.6.2的内核。 
    b. 内核patch一般是和ChangeLog对应，如patch-2.6.3对应于ChangeLog-2.6.3。 
    c. 在内核patch中查找Makefile关键字可得到相关信息，如在patch-2.6.0中有： 
         diff -Nru a/Makefile b/Makefile 
         &mdash; a/Makefile  Wed Dec 17 19:00:07 2003 
         +++ b/Makefile  Wed Dec 17 19:00:07 2003 
         @@ -1,7 +1,7 @@ 
         VERSION = 2 
         PATCHLEVEL = 6 
         SUBLEVEL = 0 
         -EXTRAVERSION = -test11 
         +EXTRAVERSION = 
    d. 找到了针对的内核就可以用patch来升级内核了。 
</p>
<p>  
2.6 如何统计linux内核有多少行代码? 
    尝试以下shell命令： 
    find /usr/src/linux-2.x.x  -name "*.[chS]" | xargs cat | wc -l 
</p>
<p>  
2.7 xx结构的定义在哪个内核源文件中？ 
    a. 请使用源码查看工具，见问题2.4。 
    b. 如果用grep等文本搜索工具，主要在include/linux和include/asm两个目录下 
       搜索。 
</p>
<p>  
2.8 volatile和_<sub>volatile</sub>_<sub>是什么意思？</sub> 
    a. volatile是C语言定义的关键字，gcc为了需要又定义了_<sub>volatile</sub>_<sub>，它和</sub> 
       volatile表达的是同一意思。 
    b. volatile的本意是"易变的"，由于访问寄存器的速度快于访存，所以编译器一般 
       都会作优化以减少访存。如果变量加上volatile修饰，则编译器就不会对此变量 
       的读写操作进行优化，即不通过寄存器缓冲而直接访存。 
    c. _<sub>asm</sub>__ _<sub>volatile</sub>_<sub>一起指示编译器不要改动优化后面的汇编语句。</sub> 
    d.一般说来，volatile用在如下的几个地方： 
         i)中断服务程序中修改的供其它程序检测的变量需要加volatile； 
         ii)多任务环境下各任务间共享的标志应该加volatile； 
         iii)存储器映射的硬件寄存器通常也要加volatile说明，因为每次对它的读写都可能由不同意义； 
</p>
<p>  
2.9 do{ &hellip; } while(0)是什么意思？ 
    a. 主要是为了避免宏在不同情况展开可能会出现的一些错误。 
    b. 在<a href="http://www.kernelnewbies.org/faq/上有详细介绍">http://www.kernelnewbies.org/faq/上有详细介绍</a>。 
</p>
<p>  
2.10 list<sub>entry的定义是怎么回事？</sub> 
    a. list<sub>entry的定义在内核源文件include</sub>/linux/list.h中： 
       #define list<sub>entry</sub>(ptr, type, member) \ 
         ((type *)((char *)(ptr)-(unsigned long)(&amp;((type *)0)-&gt;member))) 
    b. 其功能是根据list<sub>head型指针ptr换算成其宿主结构的起始地址，该宿主结构是</sub> 
       type型的，而ptr在其宿主结构中定义为member成员。如下图： 
</p>
<p>  
       req&ndash;&gt;|type型对象起始地址 
</p><table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">&hellip; &hellip; </td></tr>
</tbody>
</table>

       ptr&ndash;&gt;|ptr指针所指的member成员地址 
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<colgroup><col class="left" />
</colgroup>
<tbody>
<tr><td class="left">&hellip; &hellip; </td></tr>
</tbody>
</table>


<p>  
      ptr指向图中所示的位置，通过(unsigned long)(&amp;((type*)0)-&gt;member)得到ptr 
      和req之间的差值，ptr减去这个差值就得到了type型宿主结构的指针req，返回 
      类型为(type*)。 
</p>
<p>  
2.11 为什么有些内核变量找不到定义？ 
    a. 与section的起始地址和结束地址相关的变量（准确地说是常量）一般定义在arch/XXX/kernel/vmlinux.lds.S链接脚本里，如_<sub>initramfs</sub><sub>start</sub> 
    b. 一些变量和函数用宏封装过，原始的定义查找比较困难，如inb<sub>p</sub>()等等。 
</p>
<ol>
<li>模块编程问题 
</li>
</ol>

<p>3.1 模块编程需要注意什么？ 
    a. Documentation/kbuild/目录下提供内核模块编程的核心资料 
    b. 如果要用inline功能，需要在gcc编译选项中增加-O2 
</p>
<p>  
3.2 为什么insmod一个模块时显示版本不匹配？ 
    a. 某些时候用insmod -f能够成功加载，但需谨慎使用。 
</p>
<p>  
3.3 为什么出现Unresolved Symbol错误？ 
    a. 首先查看文件/proc/ksyms，看内核有没有输出这个符号，不同的内核版本如 
       2.2和2.4输出的符号会有些变化。 
    b. 如果内核输出的符号带有版本控制信息如符号printk<sub>R12345678，则性质同</sub> 
       问题3.2。 
    c. 注意：现在有很多版本都不输出sys<sub>call</sub><sub>table了，另想办法吧！</sub> 
</p>
<p>  
3.4 为什么出现no license错误？ 
    在源文件加入下面一行（加在文件头部，尾部均可）： 
    MODULE<sub>LICENSE</sub>("GPL");或者 MODULE<sub>LICENSE</sub>("Dual BSD/GPL"); 
    试模块license而定。 
</p>
<p>  
3.5 为什么看不到用printk打印的信息？ 
    a. 打印消息受级别的限制,消息级别可以通过printk设置,如: 
         printk("&lt;n&gt;something");  <i>* 其中0&lt;=n&lt;=7 *</i> 
       假设控制台的消息级别为m, 当n&lt;m时消息打印到控制台,否则不打印。 
       这样一方面可以提高要打印消息本身的级别（数字越小级别越高）， 
       另一方面可以改变控制台的消息级别(可从1到8),如改为8可用以下命令: 
    b. 用dmesg命令看。 
    c. 当系统运行klogd和syslogd时，内核消息就会由klogd分发到syslogd， 
       syslogd会根据配置文件/etc/syslog.conf作相应处理，具体可以查看syslogd 
       和syslog.conf的man页。 
</p>

<ol>
<li>内核开发问题 
</li>
</ol>

<p>4.1 怎么制作、使用patch文件？ 
    a. patch文件是由diff命令生成的,使用patch文件用patch命令，具体可查看diff 
       和patch的man页和info。 
    b. diff命令的常用选项组合是urN，如： 
         diff -urN linux/ my<sub>linux</sub>/ &gt;mypatch.diff 
</p>
<p>  
4.2 在内核中可以使用系统调用吗？ 
    a. 可以。内核源代码中就有使用系统调用的例子，如open()、execve()等。 
    b. 在内核中使用系统调用必须要在源文件中包括以下两行： 
       #define _<sub>KERNEL</sub><sub>SYSCALLS</sub>__ 
       #include &lt;linux/unistd.h&gt; 
    c. 内核中使用系统调用的相关定义可查看文件include/asm/unistd.h。 
       如果要用的系统调用该文件中没有定义，可以按照其格式自行添加。 
    d. 如果要在模块中使用系统调用，必须要自己定义errno如： 
       int errno; 
       内核在lib/errno.c中定义了errno，但该符号不导出，所以模块编程时需要自己 
       定义errno，用以存放系统调用出错号。 
</p>
<p>  
4.3 在内核中怎么打开并操作一个文件？ 
    a. 直接用open()、read()等系统调用，见问题4.2。 
    b. 用filp<sub>open</sub>()函数打开文件，得到struct file *的指针fp。 
       使用指针fp进行相应操作，如读文件可以用fp-&gt;f<sub>ops</sub>-&gt;read。 
       最后用filp<sub>close</sub>()函数关闭文件。 
       filp<sub>open</sub>()、filp<sub>close</sub>()函数在fs/open.c定义，在include/linux/fs.h中 
       声明。 
    c. 自己写包装函数，可参照文件fs/exec.c中的open<sub>exec</sub>()和kernel<sub>read</sub>()函数。 
       在<a href="http://www.linuxforum.net/forum/showflat.php?Cat=&amp;Board=linuxK">http://www.linuxforum.net/forum/showflat.php?Cat=&amp;Board=linuxK</a> 
        &amp;Number=363455&amp;page=&amp;view=&amp;sb=&amp;o=&amp;vc=1上有些代码可以参照。 
</p>
<p>  
4.4 在内核中读写文件时为什么会出现EFAULT(-14)错误？ 
    a. 内核文件系统提供的read()和write()之类的函数，期望是对用户态程序服务的， 
       所以它会验证读写缓冲区不超过用户空间的上限即0xC000 0000。但现在内核中 
       要读写文件，缓冲区在内核中即地址会超过0xC000 0000。 
    b. 在读写文件前先得到当前fs：mm<sub>segment</sub><sub>t</sub> old<sub>fs</sub>=get<sub>fs</sub>(); 
       并设置当前fs为内核fs：set<sub>fs</sub>(KERNEL<sub>DS</sub>); 
       在读写文件后再恢复原先fs: set<sub>fs</sub>(old<sub>fs</sub>); 
       set<sub>fs</sub>()、get<sub>fs</sub>()等相关宏在文件include/asm/uaccess.h中定义。 
</p>
<p>  
4.5 怎么在系统中增加一个自己的系统调用？ 
     去<a href="http://www.linuxaid.com.cn/engineer/ideal/kernel/new_syscall.htm">http://www.linuxaid.com.cn/engineer/ideal/kernel/new_syscall.htm</a> 
     和<a href="http://www.xenotime.net/linux/syscall_ex/看看">http://www.xenotime.net/linux/syscall_ex/看看</a>。 
</p>
<p>  
4.6 怎么在内核中加入自己的驱动程序？ 
    a. 去<a href="http://www-900.ibm.com/developerWorks/cn/linux/kernel/l-kerconf/">http://www-900.ibm.com/developerWorks/cn/linux/kernel/l-kerconf/</a> 
       index.shtml看看，了解一下整个内核的配置编译系统。 
    b. 在相应位置建立自己的源码目录、文件、Makefile等。 
    c. 修改上层Makefile，把自己的程序加入到内核编译系统中。 
    d. 修改上层Config.in，把自己的程序加入到内核配置系统中。 
    e. 确保自己的初始化函数被调用。有两种方法，一是显式调用，即在原来的系统 
      初始化函数中直接加入对自己的调用，如字符设备就在drivers/char/mem.c中的 
      chr<sub>dev</sub><sub>init</sub>()函数中加入，块设备就在drivers/block/ll<sub>rw</sub><sub>blk</sub>.c中的 
      blk<sub>dev</sub><sub>init</sub>()函数中加入。另一种方法是用initcall，用宏module<sub>init来申</sub> 
      明你的初始化函数，操作系统在初始化到一定阶段后会自动通过init/main.c中 
      的do<sub>initcalls</sub>()函数来统一调用这些初始化函数。module<sub>init宏在文件</sub> 
      include/linux/init.h中定义。 
</p>
<p>  
4.7 怎么通过程序得到cpu和mem使用率？ 
    a. 这些信息的最终来源都是/proc目录下的文件，如/proc/stat等。 
    b. procps包下的命令如top、vmstat等实现了这些功能，可以参照其源代码。 
    c. procps包可从Redhat发行版中得到，也可从<a href="http://www.surriel.com/procps/">http://www.surriel.com/procps/</a> 
      处获得。 
</p>
<p>  
4.8 如何获得高精度的系统时间？ 
    a. Linux中jiffy是时钟的基本单位，对于一般的系统来说配置成10ms。大多数时 
      钟相关的系统调用都是基于jiffy，所以精度不会太高。 
    b. 可以考虑使用TSC(time stamp counter)、rtc(real time clock)等寄存器来获得 
      高精度时钟，具体可查看相关的硬件手册。 
</p>
<p>  
4.9 怎么进行系统性能调谐？ 
    a. IBM developworks: 
         <a href="http://www-900.ibm.com/developerWorks/cn/linux/l-kperf/index.shtml">http://www-900.ibm.com/developerWorks/cn/linux/l-kperf/index.shtml</a> 
         <a href="http://www-900.ibm.com/developerWorks/cn/linux/management/tune/index.sht">http://www-900.ibm.com/developerWorks/cn/linux/management/tune/index.sht</a> 
ml 
    b. Linux Performance Tuning项目:<a href="http://linuxperf.nl.linux.org/">http://linuxperf.nl.linux.org/</a> 
    c. <a href="http://www.fixdown.com/article/article/724.htm">http://www.fixdown.com/article/article/724.htm</a> 
</p>
<p>  
4.10 内核中怎么进行互斥？ 
     a. Linux内核中有两种机制实现互斥：semaphore和spinlock。semaphore是让进 
       程睡眠等待资源，这一般假设无法预测资源什么时候可以获得;spin<sub>lock一般</sub> 
       用在SMP中，它假设所等待的资源马上就会被释放，所以循环等待资源。 
       semaphore只能用于非中断环境（典型的中断环境过程包括象timer之类的中断 
       服务程序,softirq等）的进程间互斥,spinlock可以用于所有的进程间包括不同 
       cpu的进程间的互斥,spinlock主要用于保护短小的临界区,使用时必须要特别注 
       意死锁问题。 
     b. semaphore是通过进程调度来实现互斥的。进程请求获取semaphore时,如果 
       semaphore空闲则该进程获得semaphore，设置标志并返回；如果semaphore忙 
       (其它用户已经获得semaphore)则系统构建等待队列并通过进程调度机制让本进 
       程睡眠。进程释放semaphore时,系统按一定规则通过等待队列唤醒一个睡眠进 
       程。对semaphore可执行up()和down()操作，详见include/asm/semaphore.h文件。 
     c. spinlock主要是为SMP互斥而引入的。在请求获取spinlock时,如果空闲则获得 
       spinlock,设置标志并返回。如果spinlock已经被其它用户获得而处于忙状态, 
       系统就会一直占用CPU资源，不停查询spinlock的状态直到获得spinlock。 
</p>

<ol>
<li>其它问题 
</li>
</ol>

<p>5.1 如何学习Linux内核？ 
     请先阅读本版精华区内核学习目录的相关文章。 
</p>
<p>  
5.2 如何下载精华区？ 
    a. 下载本站精华区详见BBShelp版置底文章“用户常见问题”。 
    b. 在本站精华区ftp上找KernelTech.html.tgz(或类似文件名)文件。 
    c. 2004-4月份的精华区下载 
   <a href="ftp://youngcow.net/Special/smth¾«»ªÇø/2004-04-09CHM/KernelTech.chm">ftp://youngcow.net/Special/smth%BE%AB%BB%AA%C7%F8/2004-04-09CHM/KernelTech.chm</a> 
5.3 init进程是核心进程吗？init与初始进程是不是一回事？ 
     Linux操作系统在系统初始化之初就捏造了一个原始进程（原始进程在系统初始化 
    完毕后就演化成idle进程），当系统初始化进行到一定阶段，原始进程会创建(通 
    过kernel<sub>thread</sub>()函数)出来init进程，init进程继续进行系统初始化工作并在最 
    后执行execve("/sbin/init",&hellip;)，这样init就从原来的核心进程摇身一变成用户 
    进程（用户程序/sbin/init）了。init进程的pid为1，原始进程（idle进程）的 
    pid为0。所有其它的进程都由init进程派生，用ps或pstree命令可以看到这一点。 
</p>
<p>  
5.4 initrd(.img)有什么用？ 
    a. initrd(.img)是一个文件系统映像，里面一般包含一些特殊的硬件模块尤其是存 
      储设备如scsi/raid/ext3模块，以便在保持内核足够小的同时又支持尽可能多的硬 
      件设备，常被安装程序使用。 
      initrd(.img)也不是必需的，只要必要的模块编译进内核就可以不用initrd(.img)。 
    b. 在使用了initrd(.img)时，系统引导的大致过程如下： 
     1)Loader程序(如lilo和grub)加载内核和initrd(.img) 
     2)内核解压缩initrd(.img)为正常的RAM盘文件系统并挂接为根分区 
     3)执行linuxrc，在此过程中会加载硬件模块 
     4)在linuxrc终止后，真正的根文件系统被挂接 
     5)在根文件系统上完成正常的引导过程。对于正常的系统而言，执行/sbin/init， 
       这时控制就会转到正常的大家所熟知的启动过程。而对于安装程序，只需将控制 
       转到安装过程的第一阶段，由它完成后续的安装环境的加载，设备的进一步初始 
       化等操作。 
    c. 要使用initrd(.img)首先内核必须配置成支持initrd： 
         CONFIG<sub>BLK</sub><sub>DEV</sub><sub>RAM</sub>=y 
         CONFIG<sub>BLK</sub><sub>DEV</sub><sub>INITRD</sub>=y 
       其次要在Loader脚本中增加相应指示。如在grub.conf中增加一行： 
         initrd /boot/initrd-2.4.20.img 
    d. 可用mkinitrd命令创建initrd(.img)文件： 
         mkinitrd  imagefilename  kernelversion 
       如对于2.4.20的内核可以： 
         mkinitrd /boot/initrd-2.4.20.img 2.4.20 
    e. 具体可查看Documentation/initrd.txt和man mkiinitrd。mkinitrd命令执行的详 
       细过程可以直接查看/sbin/mkinitrd(shell脚本)文件。 
</p>



</div>

</div>

<div id="outline-container-6" class="outline-2">
<h2 id="sec-6">Blogs</h2>
<div class="outline-text-2" id="text-6">

<ul>
<li><a href="http://free-electrons.com/">http://free-electrons.com/</a>
</li>
</ul>






</div>

</div>

<div id="outline-container-7" class="outline-2">
<h2 id="sec-7">Linux Cross Reference</h2>
<div class="outline-text-2" id="text-7">

<p><a href="http://lxr.free-electrons.com/source/?v=2.6.29">http://lxr.free-electrons.com/source/?v=2.6.29</a>
</p>
</div>

</div>

<div id="outline-container-8" class="outline-2">
<h2 id="sec-8">kernel blog</h2>
<div class="outline-text-2" id="text-8">

<p><a href="http://blog.csdn.net/gdt_a20/article/details/7219024">http://blog.csdn.net/gdt_a20/article/details/7219024</a>
<a href="http://blog.csdn.net/droidphone/article/details/7497787">http://blog.csdn.net/droidphone/article/details/7497787</a>
<a href="http://blog.csdn.net/fudan_abc/article/details/1751565">http://blog.csdn.net/fudan_abc/article/details/1751565</a>
</p>
</div>

</div>

<div id="outline-container-9" class="outline-2">
<h2 id="sec-9">The Linux Kernel API</h2>
<div class="outline-text-2" id="text-9">

<p><a href="http://gnugeneration.com/books/linux/2.6.20/kernel-api/index.html">http://gnugeneration.com/books/linux/2.6.20/kernel-api/index.html</a>
<a href="http://gnugeneration.com/">http://gnugeneration.com/</a>
</p>
</div>

</div>

<div id="outline-container-10" class="outline-2">
<h2 id="sec-10">Embedded Linux Wiki</h2>
<div class="outline-text-2" id="text-10">

<p><a href="http://elinux.org/Main_Page">http://elinux.org/Main_Page</a>
</p>
</div>

</div>

<div id="outline-container-11" class="outline-2">
<h2 id="sec-11">Openembedded</h2>
<div class="outline-text-2" id="text-11">


</div>

</div>

<div id="outline-container-12" class="outline-2">
<h2 id="sec-12">Overo</h2>
<div class="outline-text-2" id="text-12">

</div>

</div>

<div id="outline-container-13" class="outline-2">
<h2 id="sec-13">free-electrons</h2>
<div class="outline-text-2" id="text-13">

<p><a href="http://free-electrons.com/docs/">http://free-electrons.com/docs/</a>
</p>
</div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2013-05-05T10:13+0800</p>
<p class="author">Author: Shi Shougang</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.3f with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
