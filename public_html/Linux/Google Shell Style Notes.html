<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Google Shell Style Notes (Revision 1.26)</title>
<!-- 2015-03-05 Thu 23:20 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Shi Shougang" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link href="../assets/bootstrap.min.css" rel="stylesheet" media="screen">
<link href="../assets/bootstrap-responsive.min.css" rel="stylesheet">
<link rel="stylesheet" type="text/css" href="../assets/stylesheet.css" />
<script src="assets/js/bootstrap.min.js"></script>

<script type="text/javascript" src="assets/js/org-info.js">
/**
 *
 * @source: assets/js/org-info.js
 *
 * @licstart  The following is the entire license notice for the
 *  JavaScript code in assets/js/org-info.js.
 *
 * Copyright (C) 2012-2013 Free Software Foundation, Inc.
 *
 *
 * The JavaScript code in this tag is free software: you can
 * redistribute it and/or modify it under the terms of the GNU
 * General Public License (GNU GPL) as published by the Free Software
 * Foundation, either version 3 of the License, or (at your option)
 * any later version.  The code is distributed WITHOUT ANY WARRANTY;
 * without even the implied warranty of MERCHANTABILITY or FITNESS
 * FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.
 *
 * As additional permission under GNU GPL version 3 section 7, you
 * may distribute non-source (e.g., minimized or compacted) forms of
 * that code without the copy of the GNU GPL normally required by
 * section 4, provided you include this license notice and a URL
 * through which recipients can access the Corresponding Source.
 *
 * @licend  The above is the entire license notice
 * for the JavaScript code in assets/js/org-info.js.
 *
 */
</script>

<script type="text/javascript">

/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/

<!--/*--><![CDATA[/*><!--*/
org_html_manager.set("TOC_DEPTH", "2");
org_html_manager.set("LINK_HOME", "");
org_html_manager.set("LINK_UP", "");
org_html_manager.set("LOCAL_TOC", "0");
org_html_manager.set("VIEW_BUTTONS", "0");
org_html_manager.set("MOUSE_HINT", "#dddddd");
org_html_manager.set("FIXED_TOC", "0");
org_html_manager.set("TOC", "0");
org_html_manager.set("VIEW", "showall");
org_html_manager.setup();  // activate after the parameters are set
/*]]>*///-->
</script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Google Shell Style Notes (Revision 1.26)</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">Homepage</a></li>
<li><a href="#sec-2">Shell Files and Interpreter Invocation</a>
<ul>
<li><a href="#sec-2-1">File Extensions</a></li>
<li><a href="#sec-2-2">SUID/SGID</a></li>
</ul>
</li>
<li><a href="#sec-3">Environment</a>
<ul>
<li><a href="#sec-3-1">STDOUT vs STDERR</a></li>
</ul>
</li>
<li><a href="#sec-4">Comments</a>
<ul>
<li><a href="#sec-4-1">File Header</a></li>
<li><a href="#sec-4-2">Function Comments</a></li>
<li><a href="#sec-4-3">Implementation Comments</a></li>
<li><a href="#sec-4-4"><span class="todo TODO">TODO</span> Comments</a></li>
</ul>
</li>
<li><a href="#sec-5">Formatting</a>
<ul>
<li><a href="#sec-5-1">Indentation</a></li>
<li><a href="#sec-5-2">Line Length and Long Strings</a></li>
<li><a href="#sec-5-3">Pipelines</a></li>
<li><a href="#sec-5-4">Loops</a></li>
<li><a href="#sec-5-5">Case statement</a></li>
<li><a href="#sec-5-6">Variable expansion</a></li>
<li><a href="#sec-5-7">Quoting</a></li>
</ul>
</li>
<li><a href="#sec-6">Features and Bugs</a>
<ul>
<li><a href="#sec-6-1">Command Substitution</a></li>
<li><a href="#sec-6-2">Test, [ and [[</a></li>
<li><a href="#sec-6-3">Testing Strings</a></li>
<li><a href="#sec-6-4">Wildcard Expansion of Filenames</a></li>
<li><a href="#sec-6-5">Eval</a></li>
<li><a href="#sec-6-6">Pipes to While</a></li>
</ul>
</li>
<li><a href="#sec-7">Naming Conventions</a>
<ul>
<li><a href="#sec-7-1">Function Names</a></li>
<li><a href="#sec-7-2">Variable Names</a></li>
<li><a href="#sec-7-3">Constants and Environment Variable Names</a></li>
<li><a href="#sec-7-4">Source Filenames</a></li>
<li><a href="#sec-7-5">Read-only Variables</a></li>
<li><a href="#sec-7-6">Use Local Variables</a></li>
<li><a href="#sec-7-7">Function Location</a></li>
<li><a href="#sec-7-8">main</a></li>
</ul>
</li>
<li><a href="#sec-8">Calling Commands</a>
<ul>
<li><a href="#sec-8-1">Checking Return Values</a></li>
<li><a href="#sec-8-2">Builtin Commands vs. External Commands</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">Homepage</h2>
<div class="outline-text-2" id="text-1">
<p>
<a href="http://google-styleguide.googlecode.com/svn/trunk/shell.xml">http://google-styleguide.googlecode.com/svn/trunk/shell.xml</a>
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">Shell Files and Interpreter Invocation</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1">File Extensions</h3>
<div class="outline-text-3" id="text-2-1">
<p class="info">
可执行文件应该没有后缀（强烈推荐）或以.sh后缀。库必须有.sh后缀而且
不能被执行。
</p>
<p>
However, for libraries it's important to know what language it is and
sometimes there's a need to have similar libraries in different
languages. This allows library files with identical purposes but
different languages to be identically named except for the
language-specific suffix.
</p>
</div>
</div>

<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2">SUID/SGID</h3>
<div class="outline-text-3" id="text-2-2">
<p class="info">
SUID和SGID被禁止。
</p>
<p>
Use sudo to provide elevated access if you need it.
</p>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">Environment</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1">STDOUT vs STDERR</h3>
<div class="outline-text-3" id="text-3-1">
<p class="info">
所有错误信息输出到STDERR
</p>
<p>
This makes it easier to separate normal status from actual issues.
</p>

<p>
A function to print out error messages along with other status
information is recommended.
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #87cefa;">err</span>() {
  <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"[$(date +'%Y-%m-%dT%H:%M:%S%z')]: $@"</span> &gt;&amp;2
}

<span style="color: #00ffff;">if</span> ! do_something; <span style="color: #00ffff;">then</span>
  err <span style="color: #ffa07a;">"Unable to do_something"</span>
  <span style="color: #00ffff;">exit</span> <span style="color: #ffa07a;">"${E_DID_NOTHING}"</span>
<span style="color: #00ffff;">fi</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">Comments</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-sec-4-1" class="outline-3">
<h3 id="sec-4-1">File Header</h3>
<div class="outline-text-3" id="text-4-1">
<p class="info">
每个文件以一段它内容的描述开始。
</p>
<p>
Every file must have a top-level comment including a brief overview of its contents. A copyright notice and author information are optional.
</p>

<p>
Example:
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/bin/</span><span style="color: #00ffff;">bash</span>
<span style="color: #ff7f24;">#</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Perform hot backups of Oracle databases.</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-2" class="outline-3">
<h3 id="sec-4-2">Function Comments</h3>
<div class="outline-text-3" id="text-4-2">
<p class="info">
长而不清晰的函数都必须注释。库中的函数都要注释，
</p>
<p>
All function comments should contain:
</p>

<ul class="org-ul">
<li>Description of the function
</li>
<li>Global variables used and modified
</li>
<li>Arguments taken
</li>
<li>Returned values other than the default exit status of the last
command run
</li>
</ul>

<p>
Example:
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;">#</span><span style="color: #ff7f24;">!/bin/</span><span style="color: #00ffff;">bash</span>
<span style="color: #ff7f24;">#</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Perform hot backups of Oracle databases.</span>

<span style="color: #b0c4de;">export</span> <span style="color: #eedd82;">PATH</span>=<span style="color: #ffa07a;">'/usr/xpg4/bin:/usr/bin:/opt/csw/bin:/opt/goog/bin'</span>

<span style="color: #ff7f24;">#######################################</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Cleanup files from the backup dir</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Globals:</span>
<span style="color: #ff7f24;">#   </span><span style="color: #ff7f24;">BACKUP_DIR</span>
<span style="color: #ff7f24;">#   </span><span style="color: #ff7f24;">ORACLE_SID</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Arguments:</span>
<span style="color: #ff7f24;">#   </span><span style="color: #ff7f24;">None</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Returns:</span>
<span style="color: #ff7f24;">#   </span><span style="color: #ff7f24;">None</span>
<span style="color: #ff7f24;">#######################################</span>
<span style="color: #87cefa;">cleanup</span>() {
  ...
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-4-3" class="outline-3">
<h3 id="sec-4-3">Implementation Comments</h3>
<div class="outline-text-3" id="text-4-3">
<p class="info">
在代码中，对巧妙的，不清晰的，有趣或重要的部分注释。
</p>
</div>
</div>
<div id="outline-container-sec-4-4" class="outline-3">
<h3 id="sec-4-4"><span class="todo TODO">TODO</span> Comments</h3>
<div class="outline-text-3" id="text-4-4">
<p class="info">
对那些临时的, 短期的解决方案, 或已经够好但仍不完美的代码使用 TODO 注释.
</p>
<p>
TODOs should include the string TODO in all caps, followed by your
username in parentheses. A colon is optional. It's preferable to put a
bug/ticket number next to the TODO item as well.
</p>

<p>
Examples:
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">TODO(mrmonkey): Handle the unlikely edge cases (bug ####)</span>
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">Formatting</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1">Indentation</h3>
<div class="outline-text-3" id="text-5-1">
<p class="info">
缩进2个空格。不要用tab。
</p>
<p>
Use blank lines between blocks to improve readability. Indentation is
two spaces. Whatever you do, don't use tabs. For existing files, stay
faithful to the existing indentation.
</p>
</div>
</div>

<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2">Line Length and Long Strings</h3>
<div class="outline-text-3" id="text-5-2">
<p class="info">
最大行长度是80字符。
</p>
<p>
If you have to write strings that are longer than 80 characters, this
should be done with a here document or an embedded newline if
possible. Literal strings that have to be longer than 80 chars and
can't sensibly be split are ok, but it's strongly preferred to find a
way to make it shorter.
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">DO use 'here document's</span>
cat &lt;&lt;END;
<span style="color: #ffff00; font-weight: bold;">I am an exceptionally long</span>
<span style="color: #ffff00; font-weight: bold;">string.</span>
<span style="color: #ffff00; font-weight: bold;">END</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Embedded newlines are ok too</span>
<span style="color: #eedd82;">long_string</span>=<span style="color: #ffa07a;">"I am an exceptionally</span>
<span style="color: #ffa07a;">  long string."</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3">Pipelines</h3>
<div class="outline-text-3" id="text-5-3">
<p class="info">
多个管道如果不能在一行，那么就一行一个。
</p>
<p>
If not, it should be split at one pipe segment per line with the pipe
on the newline and a 2 space indent for the next section of the pipe.
This applies to a chain of commands combined using '|' as well as to
logical compounds using '||' and '&amp;&amp;'.
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">All fits on one line</span>
command1 | command2

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Long commands</span>
command1 <span style="color: #ffa07a;">\</span>
  | command2 <span style="color: #ffa07a;">\</span>
  | command3 <span style="color: #ffa07a;">\</span>
  | command4
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4" class="outline-3">
<h3 id="sec-5-4">Loops</h3>
<div class="outline-text-3" id="text-5-4">
<p class="info">
使用<code>while</code>,<code>for</code>.或<code>if</code>时，把
<code>;do</code>和<code>;then</code>放在一行。
</p>
<p>
That is: ; then and ; do should be on the same line as the
if/for/while. <code>else</code> should be on its own line and closing statements
should be on their own line vertically aligned with the opening
statement.
</p>

<p>
Example:
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #00ffff;">for</span> dir<span style="color: #00ffff;"> in</span> ${<span style="color: #eedd82;">dirs_to_cleanup</span>}; <span style="color: #00ffff;">do</span>
  <span style="color: #00ffff;">if</span> [[ -d <span style="color: #ffa07a;">"${dir}/${ORACLE_SID}"</span> ]]; <span style="color: #00ffff;">then</span>
    log_date <span style="color: #ffa07a;">"Cleaning up old files in ${dir}/${ORACLE_SID}"</span>
    rm <span style="color: #ffa07a;">"${dir}/${ORACLE_SID}/"</span>*
    <span style="color: #00ffff;">if</span> [[ <span style="color: #ffa07a;">"$?"</span> -ne 0 ]]; <span style="color: #00ffff;">then</span>
      error_message
    <span style="color: #00ffff;">fi</span>
  <span style="color: #00ffff;">else</span>
    mkdir -p <span style="color: #ffa07a;">"${dir}/${ORACLE_SID}"</span>
    <span style="color: #00ffff;">if</span> [[ <span style="color: #ffa07a;">"$?"</span> -ne 0 ]]; <span style="color: #00ffff;">then</span>
      error_message
    <span style="color: #00ffff;">fi</span>
  <span style="color: #00ffff;">fi</span>
<span style="color: #00ffff;">done</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-5" class="outline-3">
<h3 id="sec-5-5">Case statement</h3>
<div class="outline-text-3" id="text-5-5">
<p class="info">
选项缩进2个空格
<br>在一行的选项中，用空格分割分别在右括号后和;;之前</br>
<br>长或多命令选项需要分成这样形式的多行:匹配项，操作，和;;</br>
</p>
<p>
The matching expressions are indented one level from the 'case' and
'esac'. Multiline actions are indented another level. In general,
there is no need to quote match expressions. Pattern expressions
should not be preceded by an open parenthesis. Avoid the ;&amp; and ;;&amp;
notations.
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #00ffff;">case</span> <span style="color: #ffa07a;">"${expression}"</span><span style="color: #00ffff;"> in</span>
  a)
    <span style="color: #eedd82;">variable</span>=<span style="color: #ffa07a;">"..."</span>
    some_command <span style="color: #ffa07a;">"${variable}"</span> <span style="color: #ffa07a;">"${other_expr}"</span> ...
    ;;
  absolute)
    <span style="color: #eedd82;">actions</span>=<span style="color: #ffa07a;">"relative"</span>
    another_command <span style="color: #ffa07a;">"${actions}"</span> <span style="color: #ffa07a;">"${other_expr}"</span> ...
    ;;
  *)
    error <span style="color: #ffa07a;">"Unexpected expression '${expression}'"</span>
    ;;
<span style="color: #00ffff;">esac</span>
</pre>
</div>
<p>
Simple commands may be put on the same line as the pattern and ;; as
long as the expression remains readable. This is often appropriate for
single-letter option processing. When on the same line as the actions,
use a space after the close parenthesis of the pattern and another
before the ;;.
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #eedd82;">verbose</span>=<span style="color: #ffa07a;">'false'</span>
<span style="color: #eedd82;">aflag</span>=<span style="color: #ffa07a;">''</span>
<span style="color: #eedd82;">bflag</span>=<span style="color: #ffa07a;">''</span>
<span style="color: #eedd82;">files</span>=<span style="color: #ffa07a;">''</span>
<span style="color: #00ffff;">while </span><span style="color: #b0c4de;">getopts</span> <span style="color: #ffa07a;">'abf:v'</span> flag; <span style="color: #00ffff;">do</span>
  <span style="color: #00ffff;">case</span> <span style="color: #ffa07a;">"${flag}"</span><span style="color: #00ffff;"> in</span>
    a) <span style="color: #eedd82;">aflag</span>=<span style="color: #ffa07a;">'true'</span> ;;
    b) <span style="color: #eedd82;">bflag</span>=<span style="color: #ffa07a;">'true'</span> ;;
    f) <span style="color: #eedd82;">files</span>=<span style="color: #ffa07a;">"${OPTARG}"</span> ;;
    v) <span style="color: #eedd82;">verbose</span>=<span style="color: #ffa07a;">'true'</span> ;;
    *) error <span style="color: #ffa07a;">"Unexpected option ${flag}"</span> ;;
  <span style="color: #00ffff;">esac</span>
<span style="color: #00ffff;">done</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-6" class="outline-3">
<h3 id="sec-5-6">Variable expansion</h3>
<div class="outline-text-3" id="text-5-6">
<p class="info">
优先顺序：保持之前风格;把变量放引号里，用"${var}"代替"$var"，但看如下细节。
</p>

<p>
They are listed in order of precedence.
</p>

<ol class="org-ol">
<li>Stay consistent with what you find for existing code.
</li>
<li>Quote variables, see Quoting section below.
</li>
<li>Don't brace-quote single character shell specials / positional
parameters, unless strictly necessary or avoiding deep confusion. 
Prefer brace-quoting all other variables.
</li>
</ol>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Section of recommended cases.</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Preferred style for 'special' variables:</span>
<span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Positional: $1"</span> <span style="color: #ffa07a;">"$5"</span> <span style="color: #ffa07a;">"$3"</span>
<span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Specials: !=$!, -=$-, _=$_. ?=$?, #=$# *=$* @=$@ \$=$$ ..."</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Braces necessary:</span>
<span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"many parameters: ${10}"</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Braces avoiding confusion:</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Output is "a0b0c0"</span>
<span style="color: #b0c4de;">set</span> -- a b c
<span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"${1}0${2}0${3}0"</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Preferred style for other variables:</span>
<span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"PATH=${PATH}, PWD=${PWD}, mine=${some_var}"</span>
<span style="color: #00ffff;">while </span><span style="color: #b0c4de;">read</span> f; <span style="color: #00ffff;">do</span>
  <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"file=${f}"</span>
<span style="color: #00ffff;">done</span> &lt; &lt;(ls -l /tmp)

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Section of discouraged cases</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Unquoted vars, unbraced vars, brace-quoted single letter</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">shell specials.</span>
<span style="color: #b0c4de;">echo</span> <span style="color: #eedd82;">a</span>=$<span style="color: #eedd82;">avar</span> <span style="color: #ffa07a;">"b=$bvar"</span> <span style="color: #ffa07a;">"PID=${$}"</span> <span style="color: #ffa07a;">"${1}"</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Confusing use: this is expanded as "${1}0${2}0${3}0",</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">not "${10}${20}${30}</span>
<span style="color: #b0c4de;">set</span> -- a b c
<span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"$10$20$30"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-7" class="outline-3">
<h3 id="sec-5-7">Quoting</h3>
<div class="outline-text-3" id="text-5-7">
<ul class="org-ul">
<li>Always quote strings containing variables, command substitutions,
spaces or shell meta characters, unless careful unquoted expansion
is required.
</li>
<li>Prefer quoting strings that are "words" (as opposed to command
options or path names).
</li>
<li>Never quote literal integers.
</li>
<li>Be aware of the quoting rules for pattern matches in [[.
</li>
<li>Use "$@" unless you have a specific reason to use $*.
</li>
</ul>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">'Single' quotes indicate that no substitution is desired.</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">"Double" quotes indicate that substitution is required/tolerated.</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Simple examples</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">"quote command substitutions"</span>
<span style="color: #eedd82;">flag</span>=<span style="color: #ffa07a;">"$(some_command and its args "$@" 'quoted separately')"</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">"quote variables"</span>
<span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"${flag}"</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">"never quote literal integers"</span>
<span style="color: #eedd82;">value</span>=32
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">"quote command substitutions", even when you expect integers</span>
<span style="color: #eedd82;">number</span>=<span style="color: #ffa07a;">"$(generate_number)"</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">"prefer quoting words", not compulsory</span>
<span style="color: #b0c4de;">readonly</span> <span style="color: #eedd82;">USE_INTEGER</span>=<span style="color: #ffa07a;">'true'</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">"quote shell meta characters"</span>
<span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">'Hello stranger, and well met. Earn lots of $$$'</span>
<span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Process $$: Done making \$\$\$."</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">"command options or path names"</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">($1 is assumed to contain a value here)</span>
grep -li Hugo /dev/null <span style="color: #ffa07a;">"$1"</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Less simple examples</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">"quote variables, unless proven false": ccs might be empty</span>
git send-email --to <span style="color: #ffa07a;">"${reviewers}"</span> ${<span style="color: #eedd82;">ccs</span>:+<span style="color: #ffa07a;">"--cc"</span> <span style="color: #ffa07a;">"${ccs}"</span>}

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Positional parameter precautions: $1 might be unset</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Single quotes leave regex as-is.</span>
grep -cP <span style="color: #ffa07a;">'([Ss]pecial|\|?characters*)$'</span> ${<span style="color: #eedd82;">1</span>:+<span style="color: #ffa07a;">"$1"</span>}

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">For passing on arguments,</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">"$@" is right almost everytime, and</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">$* is wrong almost everytime:</span>
<span style="color: #ff7f24;">#</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">* $* and $@ will split on spaces, clobbering up arguments</span>
<span style="color: #ff7f24;">#   </span><span style="color: #ff7f24;">that contain spaces and dropping empty strings;</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">* "$@" will retain arguments as-is, so no args</span>
<span style="color: #ff7f24;">#   </span><span style="color: #ff7f24;">provided will result in no args being passed on;</span>
<span style="color: #ff7f24;">#   </span><span style="color: #ff7f24;">This is in most cases what you want to use for passing</span>
<span style="color: #ff7f24;">#   </span><span style="color: #ff7f24;">on arguments.</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">* "$*" expands to one argument, with all args joined</span>
<span style="color: #ff7f24;">#   </span><span style="color: #ff7f24;">by (usually) spaces,</span>
<span style="color: #ff7f24;">#   </span><span style="color: #ff7f24;">so no args provided will result in one empty string</span>
<span style="color: #ff7f24;">#   </span><span style="color: #ff7f24;">being passed on.</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">(Consult 'man bash' for the nit-grits ;-)</span>

<span style="color: #b0c4de;">set</span> -- 1 <span style="color: #ffa07a;">"2 two"</span> <span style="color: #ffa07a;">"3 three tres"</span>; <span style="color: #b0c4de;">echo</span> $<span style="color: #eedd82;">#</span> ; <span style="color: #b0c4de;">set</span> -- <span style="color: #ffa07a;">"$*"</span>; <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"$#, $@"</span>
<span style="color: #b0c4de;">set</span> -- 1 <span style="color: #ffa07a;">"2 two"</span> <span style="color: #ffa07a;">"3 three tres"</span>; <span style="color: #b0c4de;">echo</span> $<span style="color: #eedd82;">#</span> ; <span style="color: #b0c4de;">set</span> -- <span style="color: #ffa07a;">"$@"</span>; <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"$#, $@"</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">Features and Bugs</h2>
<div class="outline-text-2" id="text-6">
</div><div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1">Command Substitution</h3>
<div class="outline-text-3" id="text-6-1">
<p class="info">
使用 $(command) 代替重音符(``)
</p>
<p>
Nested backticks require escaping the inner ones with \. The
<code>$(command)</code> format doesn't change when nested and is easier to read.
</p>

<p>
Example:
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">This is preferred:</span>
<span style="color: #eedd82;">var</span>=<span style="color: #ffa07a;">"$(command "$(command1)")"</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">This is not:</span>
<span style="color: #eedd82;">var</span>=<span style="color: #ffa07a;">"`command \`command1\``"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-2" class="outline-3">
<h3 id="sec-6-2">Test, [ and [[</h3>
<div class="outline-text-3" id="text-6-2">
<p class="info">
用[[ ... ]], 不要用[, test和/usr/bin/[.
</p>
<p>
<code>[[ ... ]]</code> reduces errors as no pathname expansion or word splitting takes
place between <code>[[</code> and <code>]]</code> and <code>[[</code> &#x2026; <code>]]</code> allows for regular expression matching
where [ &#x2026; ] does not.
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">This ensures the string on the left is made up of characters in the</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">alnum character class followed by the string name.</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Note that the RHS should not be quoted here.</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">For the gory details, see</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">E14 at http://tiswww.case.edu/php/chet/bash/FAQ</span>
<span style="color: #00ffff;">if</span> [[ <span style="color: #ffa07a;">"filename"</span> =~ ^[[:alnum:]]+name ]]; <span style="color: #00ffff;">then</span>
  <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Match"</span>
<span style="color: #00ffff;">fi</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">This matches the exact pattern "f*" (Does not match in this case)</span>
<span style="color: #00ffff;">if</span> [[ <span style="color: #ffa07a;">"filename"</span> == <span style="color: #ffa07a;">"f*"</span> ]]; <span style="color: #00ffff;">then</span>
  <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Match"</span>
<span style="color: #00ffff;">fi</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">This gives a "too many arguments" error as f* is expanded to the</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">contents of the current directory</span>
<span style="color: #00ffff;">if</span> [ <span style="color: #ffa07a;">"filename"</span> == f* ]; <span style="color: #00ffff;">then</span>
  <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Match"</span>
<span style="color: #00ffff;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-3" class="outline-3">
<h3 id="sec-6-3">Testing Strings</h3>
<div class="outline-text-3" id="text-6-3">
<p class="info">
尽量使用引号，而不是填充字符。
</p>
<p>
Bash is smart enough to deal with an empty string in a test. So, given
that the code is much easier to read, use tests for empty/non-empty
strings or empty strings rather than filler characters.
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Do this:</span>
<span style="color: #00ffff;">if</span> [[ <span style="color: #ffa07a;">"${my_var}"</span> = <span style="color: #ffa07a;">"some_string"</span> ]]; <span style="color: #00ffff;">then</span>
  do_something
<span style="color: #00ffff;">fi</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">-z (string length is zero) and -n (string length is not zero) are</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">preferred over testing for an empty string</span>
<span style="color: #00ffff;">if</span> [[ -z <span style="color: #ffa07a;">"${my_var}"</span> ]]; <span style="color: #00ffff;">then</span>
  do_something
<span style="color: #00ffff;">fi</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">This is OK (ensure quotes on the empty side), but not preferred:</span>
<span style="color: #00ffff;">if</span> [[ <span style="color: #ffa07a;">"${my_var}"</span> = <span style="color: #ffa07a;">""</span> ]]; <span style="color: #00ffff;">then</span>
  do_something
<span style="color: #00ffff;">fi</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Not this:</span>
<span style="color: #00ffff;">if</span> [[ <span style="color: #ffa07a;">"${my_var}X"</span> = <span style="color: #ffa07a;">"some_stringX"</span> ]]; <span style="color: #00ffff;">then</span>
  do_something
<span style="color: #00ffff;">fi</span>
To avoid confusion about what you<span style="color: #ffa07a;">'re testing for, explicitly use -z or -n.</span>

<span style="color: #ffa07a;"># Use this</span>
<span style="color: #ffa07a;">if [[ -n "${my_var}" ]]; then</span>
<span style="color: #ffa07a;">  do_something</span>
<span style="color: #ffa07a;">fi</span>

<span style="color: #ffa07a;"># Instead of this as errors can occur if ${my_var} expands to a test</span>
<span style="color: #ffa07a;"># flag</span>
<span style="color: #ffa07a;">if [[ "${my_var}" ]]; then</span>
<span style="color: #ffa07a;">  do_something</span>
<span style="color: #ffa07a;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-4" class="outline-3">
<h3 id="sec-6-4">Wildcard Expansion of Filenames</h3>
<div class="outline-text-3" id="text-6-4">
<p class="info">
当做文件名通配符扩展时，使用明确的路径。
</p>
<p>
As filenames can begin with a -, it's a lot safer to expand wildcards
with <code>./*</code> instead of <code>*</code>.
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Here's the contents of the directory:</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">-f  -r  somedir  somefile</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">This deletes almost everything in the directory by force</span>
psa@bilby$ rm -v *
removed directory: <span style="color: #fa8072;">`somedir'</span>
<span style="color: #fa8072;">removed `</span>somefile<span style="color: #ffa07a;">'</span>

<span style="color: #ffa07a;"># As opposed to:</span>
<span style="color: #ffa07a;">psa@bilby$ rm -v ./*</span>
<span style="color: #ffa07a;">removed `./-f'</span>
removed <span style="color: #fa8072;">`./-r'</span>
<span style="color: #fa8072;">rm: cannot remove `</span>./somedir<span style="color: #ffa07a;">': Is a directory</span>
<span style="color: #ffa07a;">removed `./somefile'</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-5" class="outline-3">
<h3 id="sec-6-5">Eval</h3>
<div class="outline-text-3" id="text-6-5">
<p class="info">
eval应该被避免使用。
</p>
<p>
Eval munges the input when used for assignment to variables and can
set variables without making it possible to check what those variables
were.
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">What does this set?</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Did it succeed? In part or whole?</span>
<span style="color: #b0c4de;">eval</span> $(set_my_variables)

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">What happens if one of the returned values has a space in it?</span>
<span style="color: #eedd82;">variable</span>=<span style="color: #ffa07a;">"$(eval some_function)"</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-6" class="outline-3">
<h3 id="sec-6-6">Pipes to While</h3>
<div class="outline-text-3" id="text-6-6">
<p class="info">
使用进程替换或for循环来替代管道到while的形式。在while循环中改变的变量不会传递到父进程，因为
循环的命令运行在子shell。
</p>
<p>
The implicit subshell in a pipe to while can make it difficult to
track down bugs.
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #eedd82;">last_line</span>=<span style="color: #ffa07a;">'NULL'</span>
your_command | <span style="color: #00ffff;">while </span><span style="color: #b0c4de;">read</span> line; <span style="color: #00ffff;">do</span>
  <span style="color: #eedd82;">last_line</span>=<span style="color: #ffa07a;">"${line}"</span>
<span style="color: #00ffff;">done</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">This will output 'NULL'</span>
<span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"${last_line}"</span>
</pre>
</div>

<p>
Use a for loop if you are confident that the input will not contain
spaces or special characters (usually, this means not user input).
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #eedd82;">total</span>=0
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Only do this if there are no spaces in return values.</span>
<span style="color: #00ffff;">for</span> value<span style="color: #00ffff;"> in</span> $(command); <span style="color: #00ffff;">do</span>
  <span style="color: #eedd82;">total</span>+=<span style="color: #ffa07a;">"${value}"</span>
<span style="color: #00ffff;">done</span>
</pre>
</div>

<p>
Using process substitution allows redirecting output but puts the
commands in an explicit subshell rather than the implicit subshell
that bash creates for the while loop.
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #eedd82;">total</span>=0
<span style="color: #eedd82;">last_file</span>=
<span style="color: #00ffff;">while </span><span style="color: #b0c4de;">read</span> count filename; <span style="color: #00ffff;">do</span>
  <span style="color: #eedd82;">total</span>+=<span style="color: #ffa07a;">"${count}"</span>
  <span style="color: #eedd82;">last_file</span>=<span style="color: #ffa07a;">"${filename}"</span>
<span style="color: #00ffff;">done</span> &lt; &lt;(your_command | uniq -c)

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">This will output the second field of the last line of output from</span>
<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">the command.</span>
<span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Total = ${total}"</span>
<span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Last one = ${last_file}"</span>
</pre>
</div>

<p>
Use while loops where it is not necessary to pass complex results to
the parent shell - this is typically where some more complex "parsing"
is required. Beware that simple examples are probably more easily done
with a tool such as awk. This may also be useful where you
specifically don't want to change the parent scope variables.
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Trivial implementation of awk expression:</span>
<span style="color: #ff7f24;">#   </span><span style="color: #ff7f24;">awk '$3 == "nfs" { print $2 " maps to " $1 }' /proc/mounts</span>
cat /proc/mounts | <span style="color: #00ffff;">while </span><span style="color: #b0c4de;">read</span> src dest type opts rest; <span style="color: #00ffff;">do</span>
  <span style="color: #00ffff;">if</span> [[ ${<span style="color: #b0c4de;">type</span>} == <span style="color: #ffa07a;">"nfs"</span> ]]; <span style="color: #00ffff;">then</span>
    <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"NFS ${dest} maps to ${src}"</span>
  <span style="color: #00ffff;">fi</span>
<span style="color: #00ffff;">done</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">Naming Conventions</h2>
<div class="outline-text-2" id="text-7">
</div><div id="outline-container-sec-7-1" class="outline-3">
<h3 id="sec-7-1">Function Names</h3>
<div class="outline-text-3" id="text-7-1">
<p class="info">
小写，下划线分割词语。分离库用::. 需要括号在函数名后。关键字function是可选的，
但是必须在一个工程内保持一致。
</p>
<p>
If you're writing single functions, use lowercase and separate words
with underscore. If you're writing a package, separate package names
with ::. Braces must be on the same line as the function name and no
space between the function name and the parenthesis.
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Single function</span>
<span style="color: #87cefa;">my_func</span>() {
  ...
}

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Part of a package</span>
mypackage::my_func() {
  ...
}
</pre>
</div>
<p>
The function keyword is extraneous when "()" is present after the
function name, but enhances quick identification of functions.
</p>
</div>
</div>

<div id="outline-container-sec-7-2" class="outline-3">
<h3 id="sec-7-2">Variable Names</h3>
<div class="outline-text-3" id="text-7-2">
<p class="info">
格式和函数名一样。
</p>
<p>
Variables names for loops should be similarly named for any variable
you're looping through.
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #00ffff;">for</span> zone<span style="color: #00ffff;"> in</span> ${<span style="color: #eedd82;">zones</span>}; <span style="color: #00ffff;">do</span>
  something_with <span style="color: #ffa07a;">"${zone}"</span>
<span style="color: #00ffff;">done</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-3" class="outline-3">
<h3 id="sec-7-3">Constants and Environment Variable Names</h3>
<div class="outline-text-3" id="text-7-3">
<p class="info">
所有大写，以下划线分格，在文件顶端定义。
</p>
<p>
Constants and anything exported to the environment should be
capitalized.
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Constant</span>
<span style="color: #b0c4de;">readonly</span> <span style="color: #eedd82;">PATH_TO_FILES</span>=<span style="color: #ffa07a;">'/some/path'</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Both constant and environment</span>
<span style="color: #b0c4de;">declare</span> -xr <span style="color: #eedd82;">ORACLE_SID</span>=<span style="color: #ffa07a;">'PROD'</span>
</pre>
</div>
<p>
Some things become constant at their first setting (for example, via
getopts). Thus, it's OK to set a constant in getopts or based on a
condition, but it should be made readonly immediately afterwards. Note
that declare doesn't operate on global variables within functions, so
readonly or export is recommended instead.
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #eedd82;">VERBOSE</span>=<span style="color: #ffa07a;">'false'</span>
<span style="color: #00ffff;">while </span><span style="color: #b0c4de;">getopts</span> <span style="color: #ffa07a;">'v'</span> flag; <span style="color: #00ffff;">do</span>
  <span style="color: #00ffff;">case</span> <span style="color: #ffa07a;">"${flag}"</span><span style="color: #00ffff;"> in</span>
    v) <span style="color: #eedd82;">VERBOSE</span>=<span style="color: #ffa07a;">'true'</span> ;;
  <span style="color: #00ffff;">esac</span>
<span style="color: #00ffff;">done</span>
<span style="color: #b0c4de;">readonly</span> VERBOSE
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-4" class="outline-3">
<h3 id="sec-7-4">Source Filenames</h3>
<div class="outline-text-3" id="text-7-4">
<p class="info">
小写，如果需要，用下划线风格词语。
</p>
<p>
This is for consistency with other code styles in Google: <code>maketemplate</code>
or <code>make_template</code> but not <code>make-template</code>.
</p>
</div>
</div>

<div id="outline-container-sec-7-5" class="outline-3">
<h3 id="sec-7-5">Read-only Variables</h3>
<div class="outline-text-3" id="text-7-5">
<p class="info">
使用readonly和declare -r来确认它们是只读的。
</p>
<p>
As globals are widely used in shell, it's important to catch errors
when working with them. When you declare a variable that is meant to
be read-only, make this explicit.
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #eedd82;">zip_version</span>=<span style="color: #ffa07a;">"$(dpkg --status zip | grep Version: | cut -d ' ' -f 2)"</span>
<span style="color: #00ffff;">if</span> [[ -z <span style="color: #ffa07a;">"${zip_version}"</span> ]]; <span style="color: #00ffff;">then</span>
  error_message
<span style="color: #00ffff;">else</span>
  <span style="color: #b0c4de;">readonly</span> zip_version
<span style="color: #00ffff;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-6" class="outline-3">
<h3 id="sec-7-6">Use Local Variables</h3>
<div class="outline-text-3" id="text-7-6">
<p class="info">
用local声明函数内的变量。声明和赋值应当在不同行。
</p>
<p>
Ensure that local variables are only seen inside a function and its
children by using local when declaring them. This avoids polluting the
global name space and inadvertently setting variables that may have
significance outside the function.
</p>

<p>
Declaration and assignment must be separate statements when the
assignment value is provided by a command substitution; as the 'local'
builtin does not propagate the exit code from the command
substitution.
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #87cefa;">my_func2</span>() {
  <span style="color: #b0c4de;">local</span> <span style="color: #eedd82;">name</span>=<span style="color: #ffa07a;">"$1"</span>

  <span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Separate lines for declaration and assignment:</span>
  <span style="color: #b0c4de;">local</span> my_var
  <span style="color: #eedd82;">my_var</span>=<span style="color: #ffa07a;">"$(my_func)"</span> || <span style="color: #00ffff;">return</span>

  <span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">DO NOT do this: $? contains the exit code of 'local', not my_func</span>
  <span style="color: #b0c4de;">local</span> <span style="color: #eedd82;">my_var</span>=<span style="color: #ffa07a;">"$(my_func)"</span>
  [[ $<span style="color: #eedd82;">?</span> -eq 0 ]] || <span style="color: #00ffff;">return</span>

  ...
}
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7-7" class="outline-3">
<h3 id="sec-7-7">Function Location</h3>
<div class="outline-text-3" id="text-7-7">
<p class="info">
在文件里把所有函数一起放在定量下面。不要在函数间隐藏可执行代码。
</p>
<p>
If you've got functions, put them all together near the top of the
file. Only includes, set statements and setting constants may be done
before declaring functions.
</p>

<p>
Don't hide executable code between functions. Doing so makes the code
difficult to follow and results in nasty surprises when debugging.
</p>
</div>
</div>

<div id="outline-container-sec-7-8" class="outline-3">
<h3 id="sec-7-8">main</h3>
<div class="outline-text-3" id="text-7-8">
<p class="info">
只要在脚本长到至少含有另外一个函数时，main函数才需要。
</p>
<p>
In order to easily find the start of the program, put the main program
in a function called main as the bottom most function. This provides
consistency with the rest of the code base as well as allowing you to
define more variables as local (which can't be done if the main code
is not a function). The last non-comment line in the file should be a
call to main:
</p>
<div class="org-src-container">

<pre class="src src-sh">main <span style="color: #ffa07a;">"$@"</span>
</pre>
</div>
<p>
Obviously, for short scripts where it's just a linear flow, main is
overkill and so is not required.
</p>
</div>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8">Calling Commands</h2>
<div class="outline-text-2" id="text-8">
</div><div id="outline-container-sec-8-1" class="outline-3">
<h3 id="sec-8-1">Checking Return Values</h3>
<div class="outline-text-3" id="text-8-1">
<p class="info">
一直检查返回值，返回有意义的值。
</p>
<p>
For unpiped commands, use $? or check directly via an if statement to
keep it simple.
</p>

<p>
Example:
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #00ffff;">if</span> ! mv <span style="color: #ffa07a;">"${file_list}"</span> <span style="color: #ffa07a;">"${dest_dir}/"</span> ; <span style="color: #00ffff;">then</span>
  <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Unable to move ${file_list} to ${dest_dir}"</span> &gt;&amp;2
  <span style="color: #00ffff;">exit</span> <span style="color: #ffa07a;">"${E_BAD_MOVE}"</span>
<span style="color: #00ffff;">fi</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Or</span>
mv <span style="color: #ffa07a;">"${file_list}"</span> <span style="color: #ffa07a;">"${dest_dir}/"</span>
<span style="color: #00ffff;">if</span> [[ <span style="color: #ffa07a;">"$?"</span> -ne 0 ]]; <span style="color: #00ffff;">then</span>
  <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Unable to move ${file_list} to ${dest_dir}"</span> &gt;&amp;2
  <span style="color: #00ffff;">exit</span> <span style="color: #ffa07a;">"${E_BAD_MOVE}"</span>
<span style="color: #00ffff;">fi</span>
</pre>
</div>

<p>
Bash also has the <code>PIPESTATUS</code> variable that allows checking of the
return code from all parts of a pipe. If it's only necessary to check
success or failure of the whole pipe, then the following is
acceptable:
</p>

<div class="org-src-container">

<pre class="src src-sh">tar -cf - ./* | ( <span style="color: #b0c4de;">cd</span> <span style="color: #ffa07a;">"${dir}"</span> &amp;&amp; tar -xf - )
<span style="color: #00ffff;">if</span> [[ <span style="color: #ffa07a;">"${PIPESTATUS[0]}"</span> -ne 0 || <span style="color: #ffa07a;">"${PIPESTATUS[1]}"</span> -ne 0 ]]; <span style="color: #00ffff;">then</span>
  <span style="color: #b0c4de;">echo</span> <span style="color: #ffa07a;">"Unable to tar files to ${dir}"</span> &gt;&amp;2
<span style="color: #00ffff;">fi</span>
</pre>
</div>
<p>
However, as <code>PIPESTATUS</code> will be overwritten as soon as you do any
other command, if you need to act differently on errors based on where
it happened in the pipe, you'll need to assign PIPESTATUS to another
variable immediately after running the command (don't forget that <code>[</code> is
a command and will wipe out PIPESTATUS).
</p>

<div class="org-src-container">

<pre class="src src-sh">tar -cf - ./* | ( <span style="color: #b0c4de;">cd</span> <span style="color: #ffa07a;">"${DIR}"</span> &amp;&amp; tar -xf - )
<span style="color: #eedd82;">return_codes</span>=(${<span style="color: #eedd82;">PIPESTATUS</span>[*]})
<span style="color: #00ffff;">if</span> [[ <span style="color: #ffa07a;">"${return_codes[0]}"</span> -ne 0 ]]; <span style="color: #00ffff;">then</span>
  do_something
<span style="color: #00ffff;">fi</span>
<span style="color: #00ffff;">if</span> [[ <span style="color: #ffa07a;">"${return_codes[1]}"</span> -ne 0 ]]; <span style="color: #00ffff;">then</span>
  do_something_else
<span style="color: #00ffff;">fi</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-8-2" class="outline-3">
<h3 id="sec-8-2">Builtin Commands vs. External Commands</h3>
<div class="outline-text-3" id="text-8-2">
<p class="info">
可以选用shell内嵌的功能或一个分开的处理，选择内嵌的功能。
</p>
<p>
We prefer the use of builtins such as the Parameter Expansion
functions in <code>bash(1)</code> as it's more robust and portable (especially when
compared to things like sed).
</p>

<p>
Example:
</p>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Prefer this:</span>
<span style="color: #eedd82;">addition</span>=$((${<span style="color: #eedd82;">X</span>} + ${<span style="color: #eedd82;">Y</span>}))
<span style="color: #eedd82;">substitution</span>=<span style="color: #ffa07a;">"${string/#foo/bar}"</span>

<span style="color: #ff7f24;"># </span><span style="color: #ff7f24;">Instead of this:</span>
<span style="color: #eedd82;">addition</span>=<span style="color: #ffa07a;">"$(expr ${X} + ${Y})"</span>
<span style="color: #eedd82;">substitution</span>=<span style="color: #ffa07a;">"$(echo "${string}" | sed -e 's/^foo/bar/')"</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Shi Shougang</p>
<p class="date">Created: 2015-03-05 Thu 23:20</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
